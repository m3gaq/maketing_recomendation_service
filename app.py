# embed streamlit docs in a streamlit app
import streamlit as st    
import pandas as pd 
import numpy as np         
import plotly.express as px
import pickle as pkl
import re
from pytrends.request import TrendReq

from our_parser import web_parse
import our_tools

def main():

    plt_topbar = pkl.load(open('plt_topbar.pkl','rb'))
    plt_topscat = pkl.load(open('plt_topscat.pkl','rb'))
    plt_product = pkl.load(open('plt_product.pkl','rb'))


    st.sidebar.title('Web Marketing Intelligence')
    st.title('Web Marketing Intelligence')
    st.write('–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞ MegaQuant. –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è –º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–æ–≤—ã—Ö —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞. –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–µ–Ω—é —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –≤–∑–≤–µ—à–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π :)')
    instruments = ['–ê–Ω–∞–ª–∏–∑ —Å—Ö–æ–∂–µ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∫–∞–Ω–∞–ª–æ–≤',
                   '–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –≤ –∫–∞–Ω–∞–ª–∞—Ö',
                   '–ú—ç—Ç—á–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞ —Å –∫–∞–Ω–∞–ª–∞–º–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è',
                   '–û—Ü–µ–Ω–∫–∞ –∫–æ—Å—Ç–æ–≤ –±—É–¥—É—â–µ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏',
                   '–¢—Ä–µ–Ω–¥—ã –≤ –≤–µ–± –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ',
                   '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π —Å–∞–π—Ç–æ–≤']

    selected_instruments = st.sidebar.multiselect('–í—ã–±–µ—Ä–µ—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç',instruments,instruments[:2]*0)
    @st.cache
    def get_related(df):
        if df.size > 0:
            related = ""
            for q in df.head(3)['query'].unique():
                related += q + ', '
            return(re.sub(r',\s$', '', related))
        else:
            return("No related queries found")

    @st.cache
    def get_top(country):
        if len(country.split()) == 1:
            ds = pytrend.trending_searches(pn=country.lower())
            ds.columns = ['trends']
            return ds.head(10).trends.unique()
        else:
            joined_name = ""
            for w in country.split():
                joined_name += w + "_"
            joined_name = re.sub(r'_$', '', joined_name)

            ds = pytrend.trending_searches(pn=joined_name.lower())
            ds.columns = ['trends']
            return ds.head(10).trends.unique()

    @st.cache
    def get_interest_over_time(pytrend):
        return pytrend.interest_over_time()

    if '–ê–Ω–∞–ª–∏–∑ —Å—Ö–æ–∂–µ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∫–∞–Ω–∞–ª–æ–≤' in selected_instruments:
        st.write('## –ê–Ω–∞–ª–∏–∑ —Å—Ö–æ–∂–µ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∫–∞–Ω–∞–ª–æ–≤')
        st.write('–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –º—ã —Å–¥–µ–ª–∞–ª–∏ –¥–ª—è —Ç–µ–±—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ –µ—Å—Ç—å —Å–≤–æ—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ 1 –ª—É—á—à–∏–π –∫–∞–Ω–∞–ª - —ç—Ç–æ –∞–≤–∏—Ç–æ. –ù–∞ —ç—Ç–æ–º –≥—Ä–∞—Ñ–∏–∫–µ —Ç—ã –º–æ–∂–µ—à—å –æ—Ü–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –Ω–æ –∏ –ø–æ —Å—Ö–æ–∂–µ—Å—Ç–∏ –¶–ê –£—Ä–∞–ª—Å–∏–±–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∫–∞–Ω–∞–ª–∞.')
        st.write(plt_topbar)
        st.write(plt_topscat)

    if '–ú—ç—Ç—á–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞ —Å –∫–∞–Ω–∞–ª–∞–º–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è' in selected_instruments:
        st.write('## –ú—ç—Ç—á–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞ —Å –∫–∞–Ω–∞–ª–∞–º–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è')
        file = st.file_uploader('–ó–∞–≥—Ä—É–∑–∏—Ç–µ csv —Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–Ω–∞–ª–æ–≤',type=['csv'])
        if file is not None: 
            st.write('–ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ –ø–æ–∫–∞–∑–∞–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞ —Å –∫–∞–Ω–∞–ª–∞–º–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è. –û–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–∞–Ω–∞–ª–µ. –ó–¥–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è  –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–º –∫–∞–º–ø–∞–Ω–∏—è–º.')
            data_social_media = pd.read_csv(file)
            one_hot_df = our_tools.match_user_product(data_social_media)
            plt_user_product = px.bar(one_hot_df.groupby('channel_id').mean(),our_tools.products)
            st.write(plt_user_product)
        else:
            st.info(
                f"""
                    üëÜ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å [channel_users.csv](https://hse.kamran.uz/share/channel_users.csv)
                    """
            )
            st.write(plt_product)

    if '–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –≤ –∫–∞–Ω–∞–ª–∞—Ö' in selected_instruments:
        st.write('## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –≤ –∫–∞–Ω–∞–ª–∞—Ö')
        file = st.file_uploader('–ó–∞–≥—Ä—É–∑–∏—Ç–µ csv –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∫–æ–º–ø–∞–Ω–∏–µ—è–º –≤ –∫–∞–Ω–∞–ª–∞—Ö',type=['csv'])
        if file is not None:
            st.write('–ó–¥–µ—Å—å –ø—Ä–∏–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –∏ RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–º https://petyaeva.ru/moscityhack2022/documentation). –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –Ω–æ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏, –ø–æ—Ö–æ–∂–µ–π –Ω–∞ —Ç—É, –æ –∫–æ—Ç–æ—Ä–æ–π –º—ã —É–∂–µ —á—Ç–æ-—Ç–æ –∑–Ω–∞–µ–º. –ö —Ç–æ–º—É –∂–µ, –º–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –∏–∑ –∫–∞–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∫–∞–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ RFM, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ø—Ä–∏—Ö–æ–¥–∏—Ç, –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫ –Ω–∞—à–µ–º—É –±–∞–Ω–∫—É –∏ –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.')
            df_ = pd.read_csv(file)
            st.write(our_tools.plt_historic_data(df_))
            st.write(our_tools.plt_historic_data_returns(df_))
            st.write('–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∫–∞–º–ø–∞–Ω–∏—è–º –∏ –∏—Ö –æ—Ü–µ–Ω–∫–∞ –ø–æ RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏. –¢–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–º–ø–∞–Ω–∏—è —Å id 8730nd –ø—Ä–∏–≤–ª–µ–∫–ª–∞ 20% –ª—É—á—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (champions) –∏ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ—Ö–æ–∂–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –±—É–¥—É—Ç —Ç–∞–∫–∂–µ —É—Å–ø–µ—à–Ω—ã.')
            st.write(our_tools.plt_rfm_segments_compaign(df_))
        else:
            st.info(
                f"""
                    üëÜ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å [channel_products.csv](https://hse.kamran.uz/share/channel_products.csv)
                    """
            )

    if '–û—Ü–µ–Ω–∫–∞ –∫–æ—Å—Ç–æ–≤ –±—É–¥—É—â–µ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏' in selected_instruments:
        st.write('## –û—Ü–µ–Ω–∫–∞ –∫–æ—Å—Ç–æ–≤ –±—É–¥—É—â–µ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏')
        st.write('''–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–∞–º–ø–∞–Ω–∏–∏ –º—ã —Ö–æ—Ç–∏–º –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –æ—Ñ—Ñ–µ—Ä –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –∏ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å, —á—Ç–æ–± –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –æ—Ñ—Ñ–µ—Ä, –Ω–∞ –∫–∞–∫–æ–π –¥–µ–Ω—å –ø—Ä–µ–¥–æ–∞–≥–∞—Ç—å –æ—Ñ—Ñ–µ—Ä ([–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤–∑—è—Ç—ã –∏–∑ uralsib.ru](https://www.uralsib.ru/)).''')
        st.write('''
* —Ü–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ñ—Ñ–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ (`cost`)

* —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç, –∫ –∫–æ—Ç–æ—Ä—ã–º –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –æ—Ñ—Ñ–µ—Ä (`offer`)

–ò—Ç–∞–∫, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º —Ç–∞–∫–∏–µ –æ—Ñ—Ñ–µ—Ä—ã:

1. **–û—Ñ—Ñ–µ—Ä ‚Ññ1:** –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–∞–∫–µ—Ç Premium –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤ –ø–µ—Ä–≤—ã–µ –¥–≤–∞ –º–µ—Å—è—Ü–∞. –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è -- 1000 —Ä—É–±–ª–µ–π. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –æ–±–ª–∞–¥–∞—Ç–µ–ª—è–º –∫–∞—Ä—Ç 'MIR Supreme' –∏ 'MIR Privilege Plus', –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∫–∞—Ä—Ç—ã

* `cost` = 2000 —Ä—É–±–ª–µ–π 

* `offer` = ['MIR Supreme', 'MIR Privilege Plus']

2. **–û—Ñ—Ñ–µ—Ä ‚Ññ2:** –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–ª—è –æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π –∫–∞—Ä—Ç '–î–µ–±–µ—Ç –∫–∞—Ä—Ç–∞ –ü–° –ú–ò–† "–ë—é–¥–∂–µ—Ç–Ω–∞—è"', '–ú–ò–† –ö–æ–ø–∏–ª–∫–∞', –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∫–∞—Ä—Ç—ã. –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è -- 99 —Ä—É–±–ª–µ–π.

* `cost` = 99 —Ä—É–±–ª–µ–π 

* `offer` = ['–î–µ–±–µ—Ç –∫–∞—Ä—Ç–∞ –ü–° –ú–ò–† "–ë—é–¥–∂–µ—Ç–Ω–∞—è"', '–ú–ò–† –ö–æ–ø–∏–ª–∫–∞']

3. **–û—Ñ—Ñ–µ—Ä ‚Ññ3:** –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞ –Ω–∞ SMS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π –∫–∞—Ä—Ç '–ú–ò–† –°–ö–ë', '–î–µ–±–µ—Ç –∫–∞—Ä—Ç–∞ –ü–° –ú–ò–† "–ë—é–¥–∂–µ—Ç–Ω–∞—è"', '–ú–ò–† –ö–æ–ø–∏–ª–∫–∞', 'MIR Supreme', 'MIR Privilege Plus', –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∫–∞—Ä—Ç—ã. –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -- 59 —Ä—É–±–ª–µ–π.

* `cost` = 59 —Ä—É–±–ª–µ–π 

* `offer` = ['–ú–ò–† –°–ö–ë', '–î–µ–±–µ—Ç –∫–∞—Ä—Ç–∞ –ü–° –ú–ò–† "–ë—é–¥–∂–µ—Ç–Ω–∞—è"', '–ú–ò–† –ö–æ–ø–∏–ª–∫–∞', 'MIR Supreme', 'MIR Privilege Plus']
''')
        st.write('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ä—Ç—ã –±—É–¥—É—â–µ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏')
        col1,col2,col3,col4 = st.columns(4)
        with col1:
            offer=st.selectbox('offer',[1,2,3],1)
        with col2:
            expected_growth=st.number_input('expected_growth in %',1,1000,10,1)/1000
        with col3:
            on_day=st.slider('on_day',0,100,0,1)
        with col4:
            zero_day=st.slider('zero_day',on_day,100,5,1)
        uti_fig, c = our_tools.utilization(offer, expected_growth, on_day, zero_day)
        st.write(f"–ö–æ—Å—Ç –Ω–∞ —É—Ç–∏–ª–∏–∑–∞—Ü–∏—é –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ {round(c, 0)} —Ä—É–±–ª–µ–π.")
        st.write(uti_fig)
    if '–¢—Ä–µ–Ω–¥—ã –≤ –≤–µ–± –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ' in selected_instruments:
        st.write('## –¢—Ä–µ–Ω–¥—ã –≤ –≤–µ–± –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ')
        st.write('–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ç–æ —Ç–≤ –º–æ–∂–µ—à—å –≤–±–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–π —Ç–µ–±—è —Ç–µ–º–∞—Ç–∏–∫–∏. –ì—Ä–∞—Ñ–∏–∫ —Ç–µ–±–µ –≤—ã–≤–µ–¥–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —ç—Ç–∏–º —Å–ª–æ–≤–∞–º. –ü—Ä–∏–º–µ—Ä: –ø–æ–ª–∏—Ç–∏–∫–∞. –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∂–µ—Ç, —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –∏—Å–∫–∞–ª–∏ –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–µ —Å–ª–æ–≤–æ ¬´–ü–æ–ª–∏—Ç–∏–∫–∞¬ª. –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ —Ç—ã –º–æ–∂–µ—à—å –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –≤–æ –≤–Ω–µ—à–Ω–µ–π —Å—Ä–µ–¥–µ.')
        pytrend = TrendReq()
        country = 'russia'
        col, col1, col2, col3, col4 = st.columns(5)
        with col:
            topic  = st.text_input('—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞', '–£—Ä–∞–ª—Å–∏–±')
        with col1:
            topic1 = st.text_input('—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ ‚Ññ1', '–¢–∏–Ω—å–∫–æ—Ñ—Ñ')
        with col2:
            topic2 = st.text_input('—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ ‚Ññ2', '–†–æ—Å–±–∞–Ω–∫')
        with col3:
            topic3 = st.text_input('—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ ‚Ññ3', '–ë–∞–Ω–∫ –ö—É–∑–Ω–µ—Ü–∫–∏–π')
        with col4:
            topic4 = st.text_input('—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ ‚Ññ4', '–ú–ö–ë')

        kw_list = [topic,topic1,topic2,topic3,topic4]
        pytrend.build_payload(kw_list=kw_list, geo='RU')

        interest_over_time_df = get_interest_over_time(pytrend)

        st.write(px.line(interest_over_time_df.drop(columns='isPartial')))

        st.write(f'–°–µ–π—á–∞—Å –Ω–∞–±–∏—Ä–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å:')

        interest_by_region_df = pytrend.interest_by_region()
        tops_one = get_top(country)

        for t in tops_one:
            with st.expander(f'{np.where(tops_one == t)[0] + 1} {t}'):

                if st.checkbox('–ü–æ–∫–∞–∑–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã', key=f'{t}one'):
                    pytrend.build_payload(kw_list=[t])
                    related_queries = pytrend.related_queries()
                    rising = pd.DataFrame(data=related_queries.get(t).get('rising'))
                    st.write(get_related(rising))

    if '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π —Å–∞–π—Ç–æ–≤' in selected_instruments:
        st.write('## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π —Å–∞–π—Ç–æ–≤')    
        st.write('–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —Å–∞–π—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–µ–π, —Ç–æ –≤–±–µ–π —Å—Å—ã–ª–∫—É –≤ –ø–æ–ª–µ –Ω–∏–∂–µ. –ü—Ä–∏–º–µ—Ä: www.vk.ru. –¢—ã —É–≤–∏–¥–∏—à—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —Å–∞–π—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª–≥–æ–¥–∞. –ß–µ–º —ç—Ç–æ —Ç–µ–±–µ –ø–æ–º–æ–∂–µ—Ç? –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∞–Ω–æ–º–∞–ª—å–Ω—É—é –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å - –Ω–∏–∑–∫—É—é –∏–ª–∏ –≤—ã—Å–æ–∫—É—é. –ú–æ–∂–µ—Ç –±—ã—Ç—å, –µ—Å—Ç—å —à–∞–Ω—Å —É—Å—Ç—Ä–æ–∏—Ç—å —É—Å–ø–µ—à–Ω—É—é —Ä–µ–∫–ª–∞–º–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å –∑–∞ —Å—á–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —à—É–º–∞, –∞ –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–∞–æ–±–æ—Ä–æ—Ç, —Å—Ç–æ–∏—Ç –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å.')
        col, col1, col2 = st.columns(3)
        with col:
            web_site  = st.text_input('—Å–∞–π—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'www.uralsib.ru')

        st.write(web_parse(web_site))



if __name__ == '__main__':
    main()
